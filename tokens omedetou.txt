//tokens
START_PROGRAM   : "Start"
FINISH_PROGRAM  : "Finish"
VAR             : "var "
WHILE           : "while"
IF              : "if "
ELSE            : "else "
DEF             : "def"
RETURN          : "return"
CLASS           : "class"
EXTENDS         : "extends"
PRINT           : "print"

LEFT_CURRLY_BRACES      : /\{/
RIGHT_CURRLY_BRACES     : /\}/ 
LEFT_PARENTHESIS  : /\(/
RIGHT_PARENTHESIS : /\)/ 
LEFT_BRACKET : /\[/
RIGHT_BRACKET : /\]/

COMMA     :  /,/    
COLON     :  /:/  
DOT       :  /\./

NEW_LINE: /\n+/
WHITESPACE: (" " | /\t/ )+

GREATER_THAN      : />/
LESS_THAN         : /</
LESS_EQUAL        : /<=/
GREATER_EQUAL       : />=/
NOT_EQUAL         : /!=/
EQUAL_COMPARATION : /==/
EQUAL            : /=/
OR               : /\|/
AND              : /\&/

PLUS             : /\+/
MINUS            : /-/
ASTERISK         : /\*/

SLASH            : /\//

INT_WORD      : "int"
FLOAT_WORD     : "float"
BOOL_WORD      : "bool"
STRING_WORD    : "String"
 
IDENTIFIER: /[a-zA-Z_][a-zA-Z0-9_]*/
CONST_INT: /\d+/
CONST_FLOAT: /\d+(\.\d+)?/
CONST_BOOL: /[a-zA-Z_][a-zA-Z0-9_]*/
CONST_STRING          : /".*"/

COMMENT : /#.*/

%ignore WHITESPACE
%ignore NEW_LINE

// rules
start: programa

programa : START_PROGRAM NEW_LINE programa2 FINISH_PROGRAM
programa2 : estatuto programa3 | class programa3
programa3 : programa2 | 

asignacion : IDENTIFIER asignacion2 EQUAL expresion NEW_LINE
asignacion2 : DOT IDENTIFIER | 

condicion  : IF LEFT_PARENTHESIS expresion RIGHT_PARENTHESIS bloque condicionElse
condicionElse : ELSE bloque |  

bloque: LEFT_CURRLY_BRACES bloqueEstatuto RIGHT_CURRLY_BRACES
bloqueEstatuto : estatuto bloqueEstatuto | 

estatuto    : asignacion 
            | condicion 
            | escritura 
            | ciclo 
            | vars
            | function
            | function_call

tipo: INT_WORD
    | FLOAT_WORD 
    | STRING_WORD
    | BOOL_WORD

ciclo : WHILE LEFT_PARENTHESIS expresion RIGHT_PARENTHESIS bloque

escritura : PRINT LEFT_PARENTHESIS expresion esc2 RIGHT_PARENTHESIS NEW_LINE
esc2: COMMA expresion esc2 | 

vars    : VAR varsType
varsType   : IDENTIFIER IDENTIFIER varsAsign NEW_LINE| tipo vars3
vars3   : asignacion | IDENTIFIER varsArray NEW_LINE
varsArray   : LEFT_BRACKET CONST_INT RIGHT_BRACKET varsMatrix | 
varsMatrix   : LEFT_BRACKET CONST_INT RIGHT_BRACKET | 
varsAsign   : EQUAL expresion |

expresion   : exp expresion1
expresion1  : expresionComparation exp | 
expresionComparation  : GREATER_THAN 
            | LESS_THAN 
            | EQUAL_COMPARATION 
            | NOT_EQUAL 
            | GREATER_EQUAL 
            | LESS_EQUAL
            | OR
            | AND

exp : termino ex1 
ex1 : expSumRes exp | 
expSumRes : PLUS | MINUS

factor  : factorFF | factor2
factorFF : LEFT_PARENTHESIS expresion RIGHT_PARENTHESIS
factor2 : factorSumResEps factorGetID
factorSumResEps : PLUS | MINUS | 
factorGetID : var_cte | IDENTIFIER DOT IDENTIFIER

termino : factor t1
t1 : terminoMD termino | 
terminoMD : ASTERISK | SLASH

class : LESS_THAN CLASS GREATER_THAN classExtended IDENTIFIER bloque
classExtended : IDENTIFIER EXTENDS | 

function  : DEF IDENTIFIER LEFT_PARENTHESIS functionParameter RIGHT_PARENTHESIS LEFT_CURRLY_BRACES estatuto functionReturn RIGHT_CURRLY_BRACES 
functionParameter : var_cte functionParameters |
functionReturn : RETURN var_cte | 
functionParameters : COMMA var_cte functionParameters | 

function_call : IDENTIFIER fcClass LEFT_PARENTHESIS fcParamLiteral RIGHT_PARENTHESIS NEW_LINE
fcClass : DOT IDENTIFIER | 
fcParamLiteral : expresion fcParams | 
fcParams : COMMA expresion fcParams | 

var_cte : IDENTIFIER
        | CONST_INT 
        | CONST_FLOAT 
        | CONST_STRING
        | CONST_BOOL
        | function_call